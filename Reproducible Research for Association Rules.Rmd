---
title: "Reproducible Research for Association Rules"
author: "Zhaoshuai Wang"
date: "2021/5/26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
```



# **Introduction**

The main goal of this analysis was to perform most common algorithm used to observe what people purchase.

This dataset gives us information about the things people purchase when they go to a shop. 

The data is taken from kaggle platform. https://www.kaggle.com/gorkhachatryan01/purchase-behaviour

**Then we do reproducibility of my methods on different datasets:**
https://www.kaggle.com/roshansharma/market-basket-optimization/version/1

# Load the data

```{r cars 0}
library(arules)
library(arulesViz)
setwd("C:/Users/wangz/Desktop")
md = read.transactions("dataset.csv",format = "basket",
                                sep = ",",skip = 0, header = TRUE)
dim(md)

#average number of items 
ave_size = mean(size(md));
ave_size 
summary(md)
```

# Check what products appear most/least often, and get visualization and plots 

```{r cars 1}
# relative frequency
round(itemFrequency(md, type="relative"),4)
# plot for relative frequency
itemFrequencyPlot(
  md,
  topN = 10,
  type = "relative",
  main = "Item frequency",
  cex.names = 0.85
)

#absolute frequency
itemFrequency(md, type="absolute")
#plot for absolute frequency
itemFrequencyPlot(
  md,
  topN = 10,
  type = "absolute",
  main = "Item frequency",
  cex.names = 0.85
)
```

The figure above shows the 10 most popular purchases. Vegetables is first, then poultry and waffles.

```{r cars 2}
#Plot for min support
itemFrequencyPlot(md, support = 0.1) #minimum support at 10%
```

# Association rules
# Global rules calculations

I use the Apriori algorithm. To simplify the analysis, I used the values:
Confidence = 0.4,  support = 0.1
After calculations, the algorithm found 38 rules.

```{r cars 3}
rules = apriori(md, parameter = list(supp = 0.1, conf = 0.4))
```

# Support
Support is a measure of how often a certain subset of items appeared in the whole data.

```{r cars 4}
rules_supp = sort(rules, by = "support", decreasing = TRUE)
rules_supp_table = inspect(head(rules_supp), linebreak = FALSE)
```

# Confidence
Confidence is a measure of how likely it is that the consumer buys product Y (rhs) if he has product/products X (lhs) in his basket.

```{r cars 5}
rules_conf = sort(rules, by = "confidence", decreasing = TRUE)
rules_conf_table = inspect(head(rules_conf), linebreak = FALSE)
```

# Lift
Lift is understood as a measure of sorts correlation.

```{r cars 6}
rules_lift = sort(rules, by = "lift", decreasing = TRUE)
rules_lift_table = inspect(head(rules_lift), linebreak = FALSE)
```

we can see the result,  for all of them, Lift values are higher than 1. So we can say that rhs products are more likely to be bought with other products (lhs list) than if they were independent. 

```{r cars 7}
plot(rules, engine="plotly")
```

# Change rhs to another product--Ice cream rules calculation
In our data, vegetables is the most frequent product in the basket analysis, we cannot observe any rules. So let's use another product as our rhs: I will take Ice cream

```{r cars 8}
rules_ice_cream = apriori(
    data = md,
    parameter = list(supp = 0.01, conf = 0.4),
    appearance = list(default = "lhs", rhs = "ice cream"),
    control = list(verbose = F)
  )
rules_ice_cream_table = inspect(rules_ice_cream, linebreak = FALSE)
```

Due to fewer transactions of this type, I reduce the initial support value to 0.01.

Due to the small sample, there is no clear pattern between the results of the analysis

```{r cars 9}
plot(rules_ice_cream, engine="plotly")
plot(rules_ice_cream, method="graph") 
```


In this paper, I used mainly Apriori method for association rules. Despite results is not very good, I think that Association Rules are an interesting method of data analysis. 

# ***Use the same methods to analyze another dataset***
```{r cars 10}
library(kableExtra)
library(arules)
library(arulesViz)
transactions = read.transactions(
  "Market_Basket_Optimisation.csv",
  format = "basket",
  sep = ",",
  skip = 0,
  header = TRUE
)
transactions
itemFrequencyPlot(
  transactions,
  topN = 20,
  type = "absolute",
  main = "Item frequency",
  cex.names = 0.85
)

rules = apriori(transactions, parameter = list(supp = 0.01, conf = 0.40))

```

# Association rules
# Global rules calculations

```{r cars 11}
rules = apriori(transactions, parameter = list(supp = 0.01, conf = 0.40))

```

# Support
```{r cars 12}
rules_supp = sort(rules, by = "support", decreasing = TRUE)
rules_supp_table = inspect(head(rules_supp), linebreak = FALSE)
rules_supp_table %>%
  kable() %>%
  kable_styling()
```

# Confidence
```{r cars 13}
rules_conf = sort(rules, by = "confidence", decreasing = TRUE)
rules_conf_table = inspect(head(rules_conf), linebreak = FALSE)
rules_conf_table %>%
  kable() %>%
  kable_styling()
```

# Lift
```{r cars 14}
rules_lift = sort(rules, by = "lift", decreasing = TRUE)
rules_lift_table = inspect(head(rules_lift), linebreak = FALSE)
rules_lift_table %>%
  kable() %>%
  kable_styling()

plot(rules, engine="plotly")
```

# Chocolate rules calculation
```{r cars 15}
rules_chocolate = apriori(
    data = transactions,
    parameter = list(supp = 0.001, conf = 0.7),
    appearance = list(default = "lhs", rhs = "chocolate"),
    control = list(verbose = F)
  )
rules_chocolate_table = inspect(rules_chocolate, linebreak = FALSE)

rules_chocolate_table %>%
  kable() %>%
  kable_styling()

plot(rules_chocolate, engine="plotly")
plot(rules_chocolate, method="graph") 
```

# Conclusions
From this project,we could see that Association Rules are an extremely interesting method of data analysis which can relatively easily find out about many interesting relationships. 
And also, I did Reproducible Research by using same methods for another datasets, which prove the reproducibility of my code. 